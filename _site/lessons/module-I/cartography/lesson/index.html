<!DOCTYPE html>
<html class="sticky-footer">

  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>Cartography and Mapping in Python</title>
    <meta name="viewport" content="width=device-width">
    <meta name="description" content="This project is about creating a bridge between newbies on Internet and remote volunteers who don’t have time to go and teach them regularly. We are localizing web literacy content to create an accessible place for school kids to be educated in their local language. The organization will produce short lectures in the form of YouTube videos in localized Indian language for teachers and parents to understand as an introduction, with a vision to encourage and teach other people to contribute and localize their web literacy content. The website will also include supplementary practice exercises and tools for educators. All resources will be open source and available to users of the website. The website and its content will be provided mainly in Indian dialects, but contributors are also encouraged to localize content in their local languages like French, Spanish, Botswana..">
    <link rel="canonical" href="/lessons/module-I/cartography/lesson/">


    <!-- Custom CSS & Bootstrap Core CSS - Uses Bootswatch Flatly Theme: https://bootswatch.com/flatly/ -->
    <link rel="stylesheet" href="/style.css">

    <!-- Custom Fonts -->
    <link rel="stylesheet" href="/css/font-awesome/css/font-awesome.min.css">
    <link href="https://fonts.googleapis.com/css?family=Montserrat:400,700" rel="stylesheet" type="text/css">
    <link href="https://fonts.googleapis.com/css?family=Lato:400,700,400italic,700italic" rel="stylesheet" type="text/css">
    <link href='https://fonts.googleapis.com/css?family=Droid+Serif:400,700,400italic,700italic' rel='stylesheet' type='text/css'>
    <link href='https://fonts.googleapis.com/css?family=Roboto+Slab:400,100,300,700' rel='stylesheet' type='text/css'>
    <link href="https://fonts.googleapis.com/css?family=Pacifico" rel="stylesheet">
    <link rel="shortcut icon" type="image/png" href="/img/logos/local-web.png">

    <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
        <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
        <script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
    <![endif]-->
</head>


  <body id="page-top" class="index no-header sticky-footer">
    <!-- Navigation -->
    <nav class="navbar navbar-default navbar-fixed-top">
        <div class="container">
            <!-- Brand and toggle get grouped for better mobile display -->
            <div class="navbar-header page-scroll">
              <a href="/"><img class="site-avatar" src="/img/logos/local-web.png" /></a>
                <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1">
                    <span class="sr-only">Toggle navigation</span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                </button>
                <a class="navbar-brand page-scroll" href="#page-top">Local Web</a>
            </div>

            <!-- Collect the nav links, forms, and other content for toggling -->
            <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
                <ul class="nav navbar-nav navbar-right">
                    <li class="hidden">
                        <a href="#page-top"></a>
                    </li>
                    <li>
                        <a class="page-scroll" href="/#what-we-do">What We Do</a>
                    </li>
                    <li>
                        <a class="page-scroll" href="/#events">Contribute</a>
                    </li>
                    <li>
                        <a class="page-scroll" href="/#come-say-hi">Contact</a>
                    </li>
                    <li>
                        <a class="page-scroll" href="/lessons/">How to Start</a>
                    </li>
	            <li>
                        <a class="page-scroll" href="https://twitter.com/joinlocalweb"><img src="/img/twitter.png" class="img-responsive img-centered" alt="" width="30" height="30"></a>
                    </li>
                </ul>
            </div>
            <!-- /.navbar-collapse -->
        </div>
        <!-- /.container-fluid -->
    </nav>



    <div class="content container">
      <div class="page">
        <h1 class="page-title">Cartography and Mapping in Python</h1>

        <hr>

        <ul>
  <li><strong>Authors</strong>: Elliott Sales de Andrade</li>
  <li><strong>Research field</strong>: Seismology</li>
  <li><strong>Lesson topic</strong>: cartography, maps, projections, Python</li>
  <li><strong>Lesson content URL</strong>: <a href="https://github.com/UofTCoders/studyGroup/tree/gh-pages/lessons/python/cartography">https://github.com/UofTCoders/studyGroup/tree/gh-pages/lessons/python/cartography</a></li>
</ul>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># Default imports</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="n">np</span>
<span class="o">%</span><span class="n">matplotlib</span> <span class="n">nbagg</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="n">plt</span>
</code></pre></div></div>

<h2 id="setup">Setup</h2>
<p>We will be using Cartopy for this lesson, so let’s import that.
The common convention is to import it as follows:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="nn">cartopy.crs</span> <span class="k">as</span> <span class="n">ccrs</span>
</code></pre></div></div>

<p>Let’s start with a simple plot of points:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<span class="n">x</span> <span class="o">=</span> <span class="mi">360</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">rand</span><span class="p">(</span><span class="mi">100</span><span class="p">)</span>
<span class="n">y</span> <span class="o">=</span> <span class="mi">180</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">rand</span><span class="p">(</span><span class="mi">100</span><span class="p">)</span> <span class="o">-</span> <span class="mi">90</span>

<span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
<span class="n">ax</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
</code></pre></div></div>

<p><img src="../lesson_files/figure_1.png" alt="figure 1" /></p>

<p>Why pick $x$ values between 0 and 360, and $y$ values between -90 and 90?
Because that corresponds to the ranges for longitudes and latitudes!
Let’s rename them.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">lon</span> <span class="o">=</span> <span class="n">x</span>
<span class="n">lat</span> <span class="o">=</span> <span class="n">y</span>
</code></pre></div></div>

<h2 id="projections">Projections</h2>

<p>The first problem with mapping is deciding in what projection to create the map.
Some interesting properties you may want in a map are:</p>

<ul>
  <li>Conformal: Preserves angles locally, implying that locally shapes are not distorted.</li>
  <li>Equal Area: Areas are conserved.</li>
  <li>Compromise: Neither conformal nor equal-area, but a balance intended to reduce overall distortion.</li>
  <li>Equidistant: All distances from one (or two) points are correct. Other equidistant properties are mentioned in the notes.</li>
  <li>Gnomonic: All great circles are straight lines.</li>
</ul>

<p>See the <a href="https://en.wikipedia.org/wiki/List_of_map_projections#Properties">Wikipedia list of projections</a>
for more information.</p>

<p>Cartopy has <a href="http://scitools.org.uk/cartopy/docs/latest/crs/projections.html">several options available</a>.
We will start with the very straightforward <a href="https://en.wikipedia.org/wiki/Equirectangular_projection">Plate Carrée</a>
(also known as Equirectangular or Equidistant Cylindrical.)
We pass an instance of the projection class to the <code class="highlighter-rouge">projection</code> keyword
argument of <code class="highlighter-rouge">Figure.add_subplot</code> to signify the projection in which the
resulting map will be made.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
<span class="n">ax</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span>
                     <span class="n">projection</span><span class="o">=</span><span class="n">ccrs</span><span class="o">.</span><span class="n">PlateCarree</span><span class="p">())</span>
<span class="n">ax</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">lon</span><span class="p">,</span> <span class="n">lat</span><span class="p">)</span>
</code></pre></div></div>

<p><img src="../lesson_files/figure_2.png" alt="figure 2" /></p>

<h2 id="adding-elements">Adding elements</h2>

<p>So far so good; let’s add some coast lines:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
<span class="n">ax</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span>
                     <span class="n">projection</span><span class="o">=</span><span class="n">ccrs</span><span class="o">.</span><span class="n">PlateCarree</span><span class="p">())</span>
<span class="n">ax</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">lon</span><span class="p">,</span> <span class="n">lat</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">coastlines</span><span class="p">()</span>
</code></pre></div></div>

<p><img src="../lesson_files/figure_3.png" alt="figure 3" /></p>

<p>Or how about a land/ocean image:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
<span class="n">ax</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span>
                     <span class="n">projection</span><span class="o">=</span><span class="n">ccrs</span><span class="o">.</span><span class="n">PlateCarree</span><span class="p">())</span>
<span class="n">ax</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">lon</span><span class="p">,</span> <span class="n">lat</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">stock_img</span><span class="p">()</span>
<span class="n">ax</span><span class="o">.</span><span class="n">coastlines</span><span class="p">()</span>
</code></pre></div></div>

<p><img src="../lesson_files/figure_4.png" alt="figure 4" /></p>

<p>And maybe some grid lines:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
<span class="n">ax</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span>
                     <span class="n">projection</span><span class="o">=</span><span class="n">ccrs</span><span class="o">.</span><span class="n">PlateCarree</span><span class="p">())</span>
<span class="n">ax</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">lon</span><span class="p">,</span> <span class="n">lat</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">stock_img</span><span class="p">()</span>
<span class="n">ax</span><span class="o">.</span><span class="n">coastlines</span><span class="p">()</span>
<span class="n">ax</span><span class="o">.</span><span class="n">gridlines</span><span class="p">()</span>
</code></pre></div></div>

<p><img src="../lesson_files/figure_5.png" alt="figure 5" /></p>

<p>This projection supports two arguments:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">ccrs</span><span class="o">.</span><span class="n">PlateCarree</span><span class="err">?</span>
</code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
<span class="n">ax</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span>
                     <span class="n">projection</span><span class="o">=</span><span class="n">ccrs</span><span class="o">.</span><span class="n">PlateCarree</span><span class="p">(</span><span class="n">central_longitude</span><span class="o">=-</span><span class="mi">79</span><span class="p">))</span>
<span class="n">ax</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">lon</span><span class="p">,</span> <span class="n">lat</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">stock_img</span><span class="p">()</span>
<span class="n">ax</span><span class="o">.</span><span class="n">coastlines</span><span class="p">()</span>
<span class="n">ax</span><span class="o">.</span><span class="n">gridlines</span><span class="p">()</span>
</code></pre></div></div>

<p><img src="../lesson_files/figure_6.png" alt="figure 6" /></p>

<h2 id="other-projections">Other projections</h2>

<p>Let’s try out a different projection now, say
<a href="https://en.wikipedia.org/wiki/Azimuthal_equidistant_projection">Azimuthal Equidistant</a>.
It preserves angles and distances from the centre of the map.
We’ll centre it on this building, 43.660924°N, 79.398329°W.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">to_lon</span> <span class="o">=</span> <span class="o">-</span><span class="mf">79.398329</span>  <span class="c"># East is positive.</span>
<span class="n">to_lat</span> <span class="o">=</span> <span class="mf">43.660924</span>

<span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
<span class="n">ax</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span>
                     <span class="n">projection</span><span class="o">=</span><span class="n">ccrs</span><span class="o">.</span><span class="n">AzimuthalEquidistant</span><span class="p">(</span><span class="n">central_longitude</span><span class="o">=</span><span class="n">to_lon</span><span class="p">,</span>
                                                          <span class="n">central_latitude</span><span class="o">=</span><span class="n">to_lat</span><span class="p">))</span>
<span class="n">ax</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">lon</span><span class="p">,</span> <span class="n">lat</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">stock_img</span><span class="p">()</span>
<span class="n">ax</span><span class="o">.</span><span class="n">coastlines</span><span class="p">()</span>
<span class="n">ax</span><span class="o">.</span><span class="n">gridlines</span><span class="p">()</span>
</code></pre></div></div>

<p><img src="../lesson_files/figure_7.png" alt="figure 7" /></p>

<p>Hmm, what happened? Our points should be all over the globe. Actually, if
you look at the previous plot, even though we changed the central longitude,
the points never moved either!</p>

<p>This is a common trap with Cartopy, but it’s also one of its most useful
features. We neglected to specify the projection in which the scatter points
originated, thus it was plotted in the map coordinates. Map coordinates are
almost always specified in metres (except for Plate Carrée) and since our
points are in degrees, they are <em>extremely</em> small (the circumference is
approximately 40,000 <em>km</em>.)</p>

<p>We can specify the input projection using the <code class="highlighter-rouge">transform=</code> keyword argument
to <code class="highlighter-rouge">ax.scatter</code>. In this case, we use the Geodetic projection for the points.
This projection is basically longitude/latitude.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
<span class="n">ax</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span>
                     <span class="n">projection</span><span class="o">=</span><span class="n">ccrs</span><span class="o">.</span><span class="n">AzimuthalEquidistant</span><span class="p">(</span><span class="n">central_longitude</span><span class="o">=</span><span class="n">to_lon</span><span class="p">,</span>
                                                          <span class="n">central_latitude</span><span class="o">=</span><span class="n">to_lat</span><span class="p">))</span>
<span class="c"># Here we add the transform argument and use the Geodetic projection.</span>
<span class="n">ax</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">lon</span><span class="p">,</span> <span class="n">lat</span><span class="p">,</span> <span class="n">transform</span><span class="o">=</span><span class="n">ccrs</span><span class="o">.</span><span class="n">Geodetic</span><span class="p">())</span>
<span class="n">ax</span><span class="o">.</span><span class="n">stock_img</span><span class="p">()</span>
<span class="n">ax</span><span class="o">.</span><span class="n">coastlines</span><span class="p">()</span>
<span class="n">ax</span><span class="o">.</span><span class="n">gridlines</span><span class="p">()</span>
</code></pre></div></div>

<p><img src="../lesson_files/figure_8.png" alt="figure 8" /></p>

<p>What’s the difference between Plate Carrée and Geodetic?
Let’s look at a map:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">ff_lon</span> <span class="o">=</span> <span class="mi">8</span> <span class="o">+</span> <span class="mi">41</span> <span class="o">/</span> <span class="mi">60</span>
<span class="n">ff_lat</span> <span class="o">=</span> <span class="mi">50</span> <span class="o">+</span> <span class="mi">7</span> <span class="o">/</span> <span class="mi">60</span>

<span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
<span class="n">ax</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span>
                     <span class="n">projection</span><span class="o">=</span><span class="n">ccrs</span><span class="o">.</span><span class="n">PlateCarree</span><span class="p">(</span><span class="n">central_longitude</span><span class="o">=</span><span class="p">(</span><span class="n">to_lon</span> <span class="o">+</span> <span class="n">ff_lon</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span><span class="p">))</span>
<span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="n">to_lon</span><span class="p">,</span> <span class="n">ff_lon</span><span class="p">],</span> <span class="p">[</span><span class="n">to_lat</span><span class="p">,</span> <span class="n">ff_lat</span><span class="p">],</span> <span class="n">c</span><span class="o">=</span><span class="s">'b'</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
        <span class="n">transform</span><span class="o">=</span><span class="n">ccrs</span><span class="o">.</span><span class="n">PlateCarree</span><span class="p">())</span>
<span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="n">to_lon</span><span class="p">,</span> <span class="n">ff_lon</span><span class="p">],</span> <span class="p">[</span><span class="n">to_lat</span><span class="p">,</span> <span class="n">ff_lat</span><span class="p">],</span> <span class="n">c</span><span class="o">=</span><span class="s">'r'</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
        <span class="n">transform</span><span class="o">=</span><span class="n">ccrs</span><span class="o">.</span><span class="n">Geodetic</span><span class="p">())</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_global</span><span class="p">()</span>
<span class="n">ax</span><span class="o">.</span><span class="n">stock_img</span><span class="p">()</span>
<span class="n">ax</span><span class="o">.</span><span class="n">coastlines</span><span class="p">()</span>
<span class="n">ax</span><span class="o">.</span><span class="n">gridlines</span><span class="p">()</span>
</code></pre></div></div>

<p><img src="../lesson_files/figure_9.png" alt="figure 9" /></p>

<p>As you can see, Plate Carrée uses the straight-line path on a longitude/latitude basis,
while Geodetic uses the shortest path in a spherical sense (the
<a href="https://en.wikipedia.org/wiki/Geodesic">geodesic</a>.)</p>

<h2 id="features">Features</h2>

<p>Let’s focus in on Canada for a bit to see what features Cartopy can depict.
We’ll switch to the
<a href="https://en.wikipedia.org/wiki/Lambert_conformal_conic_projection">Lambert Conformal Conic projection</a>
which works well for this size and range of the map, and is recommended by StatsCan.
We’ll use their recommended standard parallels (see wiki link for explanation) of
49°N and 77°N, and a central longitude of 91°52’W. The boundaries are arbitrarily
chosen to be 63°W to 123°W and 37°N to 75°N, and set with <code class="highlighter-rouge">ax.set_extent</code>.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># An arbitrary choice.</span>
<span class="n">canada_east</span> <span class="o">=</span> <span class="o">-</span><span class="mi">63</span>
<span class="n">canada_west</span> <span class="o">=</span> <span class="o">-</span><span class="mi">123</span>
<span class="n">canada_north</span> <span class="o">=</span> <span class="mi">75</span>
<span class="n">canada_south</span> <span class="o">=</span> <span class="mi">37</span>

<span class="n">standard_parallels</span> <span class="o">=</span> <span class="p">(</span><span class="mi">49</span><span class="p">,</span> <span class="mi">77</span><span class="p">)</span>
<span class="n">central_longitude</span> <span class="o">=</span> <span class="o">-</span><span class="p">(</span><span class="mi">91</span> <span class="o">+</span> <span class="mi">52</span> <span class="o">/</span> <span class="mi">60</span><span class="p">)</span>

<span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
<span class="n">ax</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span>
                     <span class="n">projection</span><span class="o">=</span><span class="n">ccrs</span><span class="o">.</span><span class="n">LambertConformal</span><span class="p">(</span><span class="n">central_longitude</span><span class="o">=</span><span class="n">central_longitude</span><span class="p">,</span>
                                                      <span class="n">standard_parallels</span><span class="o">=</span><span class="n">standard_parallels</span><span class="p">))</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_extent</span><span class="p">([</span><span class="n">canada_west</span><span class="p">,</span> <span class="n">canada_east</span><span class="p">,</span> <span class="n">canada_south</span><span class="p">,</span> <span class="n">canada_north</span><span class="p">])</span>
<span class="n">ax</span><span class="o">.</span><span class="n">stock_img</span><span class="p">()</span>
<span class="n">ax</span><span class="o">.</span><span class="n">coastlines</span><span class="p">()</span>
<span class="n">ax</span><span class="o">.</span><span class="n">gridlines</span><span class="p">()</span>
</code></pre></div></div>

<p><img src="../lesson_files/figure_10.png" alt="figure 10" /></p>

<p>Here we can see two things:</p>

<ol>
  <li>The stock image and coastlines are not very high resolution.</li>
  <li>The coastlines only show the oceanic coast; no lakes or rivers, and certainly no countries.</li>
</ol>

<p>Cartopy provides various “features” that can provide some or all of this content
at varying resolutions. Some simple shortcuts to <a href="http://www.naturalearthdata.com/">Natural Earth data</a>
are provided in the <code class="highlighter-rouge">cartopy.feature</code> module and can be added via <code class="highlighter-rouge">ax.add_feature</code>.
These are downloaded and cached on the fly, so there may be some issues if the
WiFi is being flaky in MP408.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="nn">cartopy.feature</span> <span class="k">as</span> <span class="n">cfeature</span>
</code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
<span class="n">ax</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span>
                     <span class="n">projection</span><span class="o">=</span><span class="n">ccrs</span><span class="o">.</span><span class="n">LambertConformal</span><span class="p">(</span><span class="n">central_longitude</span><span class="o">=</span><span class="n">central_longitude</span><span class="p">,</span>
                                                      <span class="n">standard_parallels</span><span class="o">=</span><span class="n">standard_parallels</span><span class="p">))</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_extent</span><span class="p">([</span><span class="n">canada_west</span><span class="p">,</span> <span class="n">canada_east</span><span class="p">,</span> <span class="n">canada_south</span><span class="p">,</span> <span class="n">canada_north</span><span class="p">])</span>
<span class="n">ax</span><span class="o">.</span><span class="n">gridlines</span><span class="p">()</span>
<span class="n">ax</span><span class="o">.</span><span class="n">add_feature</span><span class="p">(</span><span class="n">cfeature</span><span class="o">.</span><span class="n">OCEAN</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">add_feature</span><span class="p">(</span><span class="n">cfeature</span><span class="o">.</span><span class="n">LAND</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">add_feature</span><span class="p">(</span><span class="n">cfeature</span><span class="o">.</span><span class="n">LAKES</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">add_feature</span><span class="p">(</span><span class="n">cfeature</span><span class="o">.</span><span class="n">BORDERS</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">add_feature</span><span class="p">(</span><span class="n">cfeature</span><span class="o">.</span><span class="n">COASTLINE</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">add_feature</span><span class="p">(</span><span class="n">cfeature</span><span class="o">.</span><span class="n">RIVERS</span><span class="p">)</span>
</code></pre></div></div>

<p><img src="../lesson_files/figure_11.png" alt="figure 11" /></p>

<p>These are all defined on the 1:110m(illion) scale, but what if we want
something a bit higher resolution? Well, the above were just shortcuts
and we can use <code class="highlighter-rouge">cfeature.NaturalEarthFeature</code> directly with its
<code class="highlighter-rouge">scale</code> argument.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">land_50m</span> <span class="o">=</span> <span class="n">cfeature</span><span class="o">.</span><span class="n">NaturalEarthFeature</span><span class="p">(</span><span class="s">'physical'</span><span class="p">,</span> <span class="s">'land'</span><span class="p">,</span> <span class="s">'50m'</span><span class="p">,</span>
                                        <span class="n">edgecolor</span><span class="o">=</span><span class="s">'k'</span><span class="p">,</span>
                                        <span class="n">facecolor</span><span class="o">=</span><span class="n">cfeature</span><span class="o">.</span><span class="n">COLORS</span><span class="p">[</span><span class="s">'land'</span><span class="p">])</span>

<span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
<span class="n">ax</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span>
                     <span class="n">projection</span><span class="o">=</span><span class="n">ccrs</span><span class="o">.</span><span class="n">LambertConformal</span><span class="p">(</span><span class="n">central_longitude</span><span class="o">=</span><span class="n">central_longitude</span><span class="p">,</span>
                                                      <span class="n">standard_parallels</span><span class="o">=</span><span class="n">standard_parallels</span><span class="p">))</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_extent</span><span class="p">([</span><span class="n">canada_west</span><span class="p">,</span> <span class="n">canada_east</span><span class="p">,</span> <span class="n">canada_south</span><span class="p">,</span> <span class="n">canada_north</span><span class="p">])</span>
<span class="n">ax</span><span class="o">.</span><span class="n">gridlines</span><span class="p">()</span>
<span class="n">ax</span><span class="o">.</span><span class="n">add_feature</span><span class="p">(</span><span class="n">land_50m</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">add_feature</span><span class="p">(</span><span class="n">cfeature</span><span class="o">.</span><span class="n">LAKES</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">add_feature</span><span class="p">(</span><span class="n">cfeature</span><span class="o">.</span><span class="n">OCEAN</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">add_feature</span><span class="p">(</span><span class="n">cfeature</span><span class="o">.</span><span class="n">BORDERS</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">add_feature</span><span class="p">(</span><span class="n">cfeature</span><span class="o">.</span><span class="n">COASTLINE</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">add_feature</span><span class="p">(</span><span class="n">cfeature</span><span class="o">.</span><span class="n">RIVERS</span><span class="p">)</span>
</code></pre></div></div>

<p><img src="../lesson_files/figure_12.png" alt="figure 12" /></p>

<p>Now, let’s add the provinces and states (the possible names as used here
can be determined by visiting the link above):</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">provinces_50m</span> <span class="o">=</span> <span class="n">cfeature</span><span class="o">.</span><span class="n">NaturalEarthFeature</span><span class="p">(</span><span class="s">'cultural'</span><span class="p">,</span>
                                             <span class="s">'admin_1_states_provinces_lines'</span><span class="p">,</span>
                                             <span class="s">'50m'</span><span class="p">,</span>
                                             <span class="n">facecolor</span><span class="o">=</span><span class="s">'none'</span><span class="p">)</span>

<span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
<span class="n">ax</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span>
                     <span class="n">projection</span><span class="o">=</span><span class="n">ccrs</span><span class="o">.</span><span class="n">LambertConformal</span><span class="p">(</span><span class="n">central_longitude</span><span class="o">=</span><span class="n">central_longitude</span><span class="p">,</span>
                                                      <span class="n">standard_parallels</span><span class="o">=</span><span class="n">standard_parallels</span><span class="p">))</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_extent</span><span class="p">([</span><span class="n">canada_west</span><span class="p">,</span> <span class="n">canada_east</span><span class="p">,</span> <span class="n">canada_south</span><span class="p">,</span> <span class="n">canada_north</span><span class="p">])</span>
<span class="n">ax</span><span class="o">.</span><span class="n">gridlines</span><span class="p">()</span>
<span class="n">ax</span><span class="o">.</span><span class="n">add_feature</span><span class="p">(</span><span class="n">cfeature</span><span class="o">.</span><span class="n">LAND</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">add_feature</span><span class="p">(</span><span class="n">cfeature</span><span class="o">.</span><span class="n">LAKES</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">add_feature</span><span class="p">(</span><span class="n">cfeature</span><span class="o">.</span><span class="n">OCEAN</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">add_feature</span><span class="p">(</span><span class="n">cfeature</span><span class="o">.</span><span class="n">BORDERS</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">add_feature</span><span class="p">(</span><span class="n">cfeature</span><span class="o">.</span><span class="n">COASTLINE</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">add_feature</span><span class="p">(</span><span class="n">cfeature</span><span class="o">.</span><span class="n">RIVERS</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">add_feature</span><span class="p">(</span><span class="n">provinces_50m</span><span class="p">)</span>
</code></pre></div></div>

<p><img src="../lesson_files/figure_13.png" alt="figure 13" /></p>

<h2 id="web-services">Web Services</h2>

<p>Web Map Services (WMS) provide vector data as a download via some
web API and Web Map Tile Services provide raster data via a similar
interface.</p>

<p>These can be added by <code class="highlighter-rouge">ax.add_wms</code> and <code class="highlighter-rouge">ax.add_wmts</code>.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
<span class="n">ax</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span>
                     <span class="n">projection</span><span class="o">=</span><span class="n">ccrs</span><span class="o">.</span><span class="n">LambertConformal</span><span class="p">(</span><span class="n">central_longitude</span><span class="o">=</span><span class="n">central_longitude</span><span class="p">,</span>
                                                      <span class="n">standard_parallels</span><span class="o">=</span><span class="n">standard_parallels</span><span class="p">))</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_extent</span><span class="p">([</span><span class="n">canada_west</span><span class="p">,</span> <span class="n">canada_east</span><span class="p">,</span> <span class="n">canada_south</span><span class="p">,</span> <span class="n">canada_north</span><span class="p">])</span>
<span class="n">ax</span><span class="o">.</span><span class="n">gridlines</span><span class="p">()</span>

<span class="n">ax</span><span class="o">.</span><span class="n">add_wms</span><span class="p">(</span><span class="n">wms</span><span class="o">=</span><span class="s">'http://vmap0.tiles.osgeo.org/wms/vmap0'</span><span class="p">,</span>
           <span class="n">layers</span><span class="o">=</span><span class="p">[</span><span class="s">'basic'</span><span class="p">])</span>
</code></pre></div></div>

<p><img src="../lesson_files/figure_14.png" alt="figure 14" /></p>

<p>Unfortunately, WMTS doesn’t support reprojection in 0.14, but it will
in the next release 0.15, so we need to use Plate Carrée for this map.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">url</span> <span class="o">=</span> <span class="s">'https://map1c.vis.earthdata.nasa.gov/wmts-geo/wmts.cgi'</span>
<span class="n">layer</span> <span class="o">=</span> <span class="s">'VIIRS_CityLights_2012'</span>

<span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
<span class="n">ax</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span>
                     <span class="n">projection</span><span class="o">=</span><span class="n">ccrs</span><span class="o">.</span><span class="n">PlateCarree</span><span class="p">())</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_extent</span><span class="p">([</span><span class="n">canada_west</span><span class="p">,</span> <span class="n">canada_east</span><span class="p">,</span> <span class="n">canada_south</span><span class="p">,</span> <span class="n">canada_north</span><span class="p">])</span>
<span class="n">ax</span><span class="o">.</span><span class="n">gridlines</span><span class="p">()</span>
<span class="n">ax</span><span class="o">.</span><span class="n">add_wmts</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">layer</span><span class="p">)</span>
</code></pre></div></div>

<p><img src="../lesson_files/figure_15.png" alt="figure 15" /></p>

<h2 id="shapefile-io">Shapefile I/O</h2>

<p>What about outlines that you provide yourself? You might obtain a
shapefile from somewhere outlining something. These can be read
with <code class="highlighter-rouge">cartopy.io.shapereader.Reader</code>.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">from</span> <span class="nn">cartopy.io.shapereader</span> <span class="kn">import</span> <span class="n">Reader</span>
</code></pre></div></div>

<p>We will use the data files provided with the lesson here:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">data</span> <span class="o">=</span> <span class="n">Reader</span><span class="p">(</span><span class="s">'icitw_wgs84'</span><span class="p">)</span>
</code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
<span class="n">ax</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span>
                     <span class="n">projection</span><span class="o">=</span><span class="n">ccrs</span><span class="o">.</span><span class="n">LambertConformal</span><span class="p">(</span><span class="n">central_longitude</span><span class="o">=</span><span class="n">central_longitude</span><span class="p">,</span>
                                                      <span class="n">standard_parallels</span><span class="o">=</span><span class="n">standard_parallels</span><span class="p">))</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_extent</span><span class="p">([</span><span class="o">-</span><span class="mf">79.6</span><span class="p">,</span> <span class="o">-</span><span class="mf">79.2</span><span class="p">,</span> <span class="mf">43.5</span><span class="p">,</span> <span class="mf">43.9</span><span class="p">])</span>
<span class="n">ax</span><span class="o">.</span><span class="n">gridlines</span><span class="p">()</span>

<span class="n">ax</span><span class="o">.</span><span class="n">add_geometries</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">geometries</span><span class="p">(),</span> <span class="n">crs</span><span class="o">=</span><span class="n">ccrs</span><span class="o">.</span><span class="n">Geodetic</span><span class="p">(),</span> <span class="n">edgecolor</span><span class="o">=</span><span class="s">'k'</span><span class="p">,</span> <span class="n">facecolor</span><span class="o">=</span><span class="s">'none'</span><span class="p">)</span>
</code></pre></div></div>

<p><img src="../lesson_files/figure_16.png" alt="figure 16" /></p>

<p>In case you do not recognize the shapes, these are wards for the city of Toronto.</p>

<p>Each of those geometries is a <a href="http://toblerity.org/shapely/">shapely</a> object,
on which we can do things like determine if points are contained. We won’t
really go into any details of it here, though. The example below is just a
quick one-off to show how it might be used.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="nn">shapely.geometry</span> <span class="k">as</span> <span class="n">sgeom</span>
</code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">ward</span> <span class="o">=</span> <span class="nb">next</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">geometries</span><span class="p">())</span>

<span class="n">us</span> <span class="o">=</span> <span class="n">sgeom</span><span class="o">.</span><span class="n">Point</span><span class="p">(</span><span class="n">to_lon</span><span class="p">,</span> <span class="n">to_lat</span><span class="p">)</span>
<span class="n">ward</span><span class="o">.</span><span class="n">contains</span><span class="p">(</span><span class="n">us</span><span class="p">)</span>
</code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="bp">False</span>
</code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
<span class="n">ax</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span>
                     <span class="n">projection</span><span class="o">=</span><span class="n">ccrs</span><span class="o">.</span><span class="n">LambertConformal</span><span class="p">(</span><span class="n">central_longitude</span><span class="o">=</span><span class="n">central_longitude</span><span class="p">,</span>
                                                      <span class="n">standard_parallels</span><span class="o">=</span><span class="n">standard_parallels</span><span class="p">))</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_extent</span><span class="p">([</span><span class="o">-</span><span class="mf">79.6</span><span class="p">,</span> <span class="o">-</span><span class="mf">79.2</span><span class="p">,</span> <span class="mf">43.5</span><span class="p">,</span> <span class="mf">43.9</span><span class="p">])</span>
<span class="n">ax</span><span class="o">.</span><span class="n">gridlines</span><span class="p">()</span>

<span class="k">for</span> <span class="n">ward</span> <span class="ow">in</span> <span class="n">data</span><span class="o">.</span><span class="n">geometries</span><span class="p">():</span>
    <span class="k">if</span> <span class="n">ward</span><span class="o">.</span><span class="n">contains</span><span class="p">(</span><span class="n">us</span><span class="p">):</span>
        <span class="n">our_ward</span> <span class="o">=</span> <span class="n">ward</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">add_geometries</span><span class="p">(</span><span class="n">our_ward</span><span class="p">,</span> <span class="n">crs</span><span class="o">=</span><span class="n">ccrs</span><span class="o">.</span><span class="n">Geodetic</span><span class="p">(),</span> <span class="n">edgecolor</span><span class="o">=</span><span class="s">'k'</span><span class="p">,</span> <span class="n">facecolor</span><span class="o">=</span><span class="s">'r'</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">add_geometries</span><span class="p">(</span><span class="n">ward</span><span class="p">,</span> <span class="n">crs</span><span class="o">=</span><span class="n">ccrs</span><span class="o">.</span><span class="n">Geodetic</span><span class="p">(),</span> <span class="n">edgecolor</span><span class="o">=</span><span class="s">'k'</span><span class="p">,</span> <span class="n">facecolor</span><span class="o">=</span><span class="s">'none'</span><span class="p">)</span>
</code></pre></div></div>

<p><img src="../lesson_files/figure_17.png" alt="figure 17" /></p>

<p>What happened here? It turns out that the ward data is a bit buggy,
and each ward is <em>not</em> a closed polygon.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">our_ward</span><span class="o">.</span><span class="n">is_closed</span>
</code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="bp">False</span>
</code></pre></div></div>

<p>Shapely will nicely render its contents in a notebook:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">our_ward</span>
</code></pre></div></div>

<p><img src="../lesson_files/lesson_51_0.svg" alt="svg" /></p>

<p>The type can be found from the <code class="highlighter-rouge">geom_type</code> property:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">our_ward</span><span class="o">.</span><span class="n">geom_type</span>
</code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="s">'MultiPolygon'</span>
</code></pre></div></div>

<p><code class="highlighter-rouge">MultiPolygon</code> contains multiple polygons, but fortunately, there’s just the one.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">len</span><span class="p">(</span><span class="n">our_ward</span><span class="p">)</span>
</code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="mi">1</span>
</code></pre></div></div>

<p>We’ll construct a “linear ring” (basically a closed shape) from
the data in the first polygon.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">sgeom</span><span class="o">.</span><span class="n">LinearRing</span><span class="p">(</span><span class="n">our_ward</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">exterior</span><span class="o">.</span><span class="n">coords</span><span class="p">)</span>
</code></pre></div></div>

<p><img src="../lesson_files/lesson_57_0.svg" alt="svg" /></p>

<p>And if we use that in our plot, the fill colour will no longer “spill” out
over the rest of the map.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
<span class="n">ax</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span>
                     <span class="n">projection</span><span class="o">=</span><span class="n">ccrs</span><span class="o">.</span><span class="n">LambertConformal</span><span class="p">(</span><span class="n">central_longitude</span><span class="o">=</span><span class="n">central_longitude</span><span class="p">,</span>
                                                      <span class="n">standard_parallels</span><span class="o">=</span><span class="n">standard_parallels</span><span class="p">))</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_extent</span><span class="p">([</span><span class="o">-</span><span class="mf">79.6</span><span class="p">,</span> <span class="o">-</span><span class="mf">79.2</span><span class="p">,</span> <span class="mf">43.5</span><span class="p">,</span> <span class="mf">43.9</span><span class="p">])</span>
<span class="n">ax</span><span class="o">.</span><span class="n">gridlines</span><span class="p">()</span>

<span class="k">for</span> <span class="n">ward</span> <span class="ow">in</span> <span class="n">data</span><span class="o">.</span><span class="n">geometries</span><span class="p">():</span>
    <span class="k">if</span> <span class="n">ward</span><span class="o">.</span><span class="n">contains</span><span class="p">(</span><span class="n">us</span><span class="p">):</span>
        <span class="c"># Close the polygon...</span>
        <span class="n">our_ward</span> <span class="o">=</span> <span class="p">[</span><span class="n">sgeom</span><span class="o">.</span><span class="n">LinearRing</span><span class="p">(</span><span class="n">ward</span><span class="o">.</span><span class="n">geoms</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">exterior</span><span class="o">.</span><span class="n">coords</span><span class="p">)]</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">add_geometries</span><span class="p">(</span><span class="n">our_ward</span><span class="p">,</span> <span class="n">crs</span><span class="o">=</span><span class="n">ccrs</span><span class="o">.</span><span class="n">Geodetic</span><span class="p">(),</span> <span class="n">edgecolor</span><span class="o">=</span><span class="s">'k'</span><span class="p">,</span> <span class="n">facecolor</span><span class="o">=</span><span class="s">'r'</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">add_geometries</span><span class="p">(</span><span class="n">ward</span><span class="p">,</span> <span class="n">crs</span><span class="o">=</span><span class="n">ccrs</span><span class="o">.</span><span class="n">Geodetic</span><span class="p">(),</span> <span class="n">edgecolor</span><span class="o">=</span><span class="s">'k'</span><span class="p">,</span> <span class="n">facecolor</span><span class="o">=</span><span class="s">'none'</span><span class="p">)</span>
</code></pre></div></div>

<p><img src="../lesson_files/figure_18.png" alt="figure 18" /></p>

<h2 id="other-links">Other links</h2>

<ul>
  <li><a href="https://trac.osgeo.org/proj/">proj.4</a></li>
  <li><a href="http://geopandas.org/">Geopandas</a></li>
  <li><a href="https://folium.readthedocs.io/">Folium</a></li>
</ul>


      </div>

      <footer>
    <div class="container">
      <div class="row">
        <div class="col-lg-12">
          <a href="https://www.mozillascience.org">
            <img src="/img/ScienceLabSticker.ai.png" class="img-responsive img-centered" alt="">
          </a>
          <a href="/blob/gh-pages/CODE_OF_CONDUCT.md">Local-Web Code of Conduct</a>
        </div>
      </div>
    </div>
  </footer>

     <!-- jQuery Version 1.11.0 -->
    <script src="/js/jquery-1.11.0.js"></script>

    <!-- Bootstrap Core JavaScript -->
    <script src="/js/bootstrap.min.js"></script>

    <!-- Plugin JavaScript -->
    <script src="/js/jquery.easing.min.js"></script>
    <script src="/js/classie.js"></script>
    <script src="/js/cbpAnimatedHeader.js"></script>

    <!-- Custom Theme JavaScript -->
    <script src="/js/agency.js"></script>

  </body>
</html>
